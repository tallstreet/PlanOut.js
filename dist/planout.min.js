!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):"object"==typeof exports?exports.PlanOut=b():a.PlanOut=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var f=c(1),g=e(f),h=c(2),i=e(h),j=c(3),k=e(j),l=c(4),m=e(l),n=c(5),o=d(n),p=c(6),q=e(p),r=c(7),s=e(r);b["default"]={Namespace:o,Assignment:q["default"],Interpreter:i["default"],Experiment:g["default"],ExperimentSetup:s["default"],Ops:{Random:k["default"],Core:m["default"]}},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(6),h=d(g),i=c(8),j=function(){function a(b){e(this,a),this.inputs=b,this._exposureLogged=!1,this._salt=null,this._inExperiment=!0,this.name=this.getDefaultExperimentName(),this._autoExposureLog=!0,this.setup(),this._assignment=new h["default"](this.getSalt()),this._assigned=!1}return f(a,[{key:"getDefaultExperimentName",value:function(){if((0,i.isObject)(this)&&this.constructor&&this!==this.window){var a=this.constructor.toString().match(/function\s*(\w+)/);if(a&&2===a.length)return a[1]}return"GenericExperiment"}},{key:"getDefaultParamNames",value:function(){var a=this.assign.toString(),b=a.split(".set(");return b.splice(0,1),(0,i.map)(b,function(a){var b=(0,i.trimTrailingWhitespace)(a.split(",")[0]);return b.substr(1,b.length-2)})}},{key:"requireAssignment",value:function(){this._assigned||this._assign()}},{key:"requireExposureLogging",value:function(a){this.shouldLogExposure(a)&&this.logExposure()}},{key:"_assign",value:function(){this.configureLogger();var a=this.assign(this._assignment,this.inputs);a||void 0===a?this._inExperiment=!0:this._inExperiment=!1,this._assigned=!0}},{key:"setup",value:function(){}},{key:"inExperiment",value:function(){return this._inExperiment}},{key:"addOverride",value:function(a,b){this._assignment.addOverride(a,b)}},{key:"setOverrides",value:function(a){this._assignment.setOverrides(a);var b=this._assignment.getOverrides(),c=this;(0,i.forEach)(Object.keys(b),function(a){void 0!==c.inputs[a]&&(c.inputs[a]=b[a])})}},{key:"getSalt",value:function(){return this._salt?this._salt:this.name}},{key:"setSalt",value:function(a){this._salt=a,this._assignment&&(this._assignment.experimentSalt=a)}},{key:"getName",value:function(){return this.name}},{key:"assign",value:function(a,b){throw"IMPLEMENT assign"}},{key:"getParamNames",value:function(){throw"IMPLEMENT getParamNames"}},{key:"shouldFetchExperimentParameter",value:function(a){var b=this.getParamNames();return b.indexOf(a)>=0}},{key:"setName",value:function(a){var b=/\s+/g;this.name=a.replace(b,"-"),this._assignment&&(this._assignment.experimentSalt=this.getSalt())}},{key:"__asBlob",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b={name:this.getName(),time:(new Date).getTime()/1e3,salt:this.getSalt(),inputs:this.inputs,params:this._assignment.getParams()};return(0,i.extend)(b,a),b}},{key:"setAutoExposureLogging",value:function(a){this._autoExposureLog=a}},{key:"getParams",value:function(){return this.requireAssignment(),this.requireExposureLogging(),this._assignment.getParams()}},{key:"get",value:function(a,b){return this.requireAssignment(),this.requireExposureLogging(a),this._assignment.get(a,b)}},{key:"toString",value:function(){return this.requireAssignment(),this.requireExposureLogging(),JSON.stringify(this.__asBlob())}},{key:"logExposure",value:function(a){this.inExperiment()&&(this._exposureLogged=!0,this.logEvent("exposure",a))}},{key:"shouldLogExposure",value:function(a){return void 0===a||this.shouldFetchExperimentParameter(a)?this._autoExposureLog&&!this.previouslyLogged():!1}},{key:"logEvent",value:function(a,b){if(this.inExperiment()){var c;c=b?{event:a,extra_data:(0,i.shallowCopy)(b)}:{event:a},this.log(this.__asBlob(c))}}},{key:"configureLogger",value:function(){throw"IMPLEMENT configureLogger"}},{key:"log",value:function(a){throw"IMPLEMENT log"}},{key:"previouslyLogged",value:function(){throw"IMPLEMENT previouslyLogged"}}]),a}();b["default"]=j,a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(6),h=d(g),i=c(9),j=c(8),k=function(){function a(b,c,d,f){void 0===c&&(c="global_salt"),void 0===d&&(d={}),e(this,a),this._serialization=b,f?this._env=f:this._env=new h["default"](c),this.experimentSalt=this._experimentSalt=c,this._evaluated=!1,this._inExperiment=!1,this._inputs=(0,j.shallowCopy)(d)}return f(a,[{key:"inExperiment",value:function(){return this._inExperiment}},{key:"setEnv",value:function(a){return this._env=(0,j.deepCopy)(a),this}},{key:"has",value:function(a){return this._env[a]}},{key:"get",value:function(a,b){var c=this._inputs[a];c||(c=b);var d=this._env.get(a);return d?d:c}},{key:"getParams",value:function(){if(!this._evaluated){try{this.evaluate(this._serialization)}catch(a){a instanceof i.StopPlanOutException&&(this._inExperiment=a.inExperiment)}this._evaluated=!0}return this._env.getParams()}},{key:"set",value:function(a,b){return this._env.set(a,b),this}},{key:"setOverrides",value:function(a){return this._env.setOverrides(a),this}},{key:"getOverrides",value:function(){return this._env.getOverrides()}},{key:"hasOverride",value:function(a){var b=this.getOverrides();return b&&void 0!==b[a]}},{key:"evaluate",value:function(a){if((0,j.isObject)(a)&&a.op)return(0,i.operatorInstance)(a).execute(this);if((0,j.isArray)(a)){var b=this;return(0,j.map)(a,function(a){return b.evaluate(a)})}return a}}]),a}();b["default"]=k,a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},i=c(10),j=c(11),k=d(j),l=c(8),m=function(a){function b(a){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a),this.LONG_SCALE=0xfffffffffffff}return f(b,a),g(b,[{key:"compatHashCalculation",value:function(a){return parseInt(a.substr(0,13),16)}},{key:"compatZeroToOneCalculation",value:function(a){return this.getHash(a)/this.LONG_SCALE}},{key:"getUnit",value:function(a){var b=this.getArgMixed("unit");return(0,l.isArray)(b)||(b=[b]),a&&b.push(a),b}},{key:"getUniform",value:function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=1);var d=this.compatZeroToOneCalculation(c);return d*(b-a)+a}},{key:"getHash",value:function(a){var b;if(this.args.full_salt)b=this.getArgString("full_salt");else{var c=this.getArgString("salt");b=this.mapper.get("experimentSalt")+"."+c}var d=this.getUnit(a).map(function(a){return String(a)}).join("."),e=b+"."+d,f=k["default"].hash(e);return this.compatHashCalculation(f)}}]),b}(i.PlanOutOpSimple),n=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"simpleExecute",value:function(){var a=this.getArgNumber("min"),b=this.getArgNumber("max");return this.getUniform(a,b)}}]),b}(m),o=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"compatRandomIntegerCalculation",value:function(a,b){return(this.getHash()+a)%(b-a+1)}},{key:"simpleExecute",value:function(){var a=this.getArgNumber("min"),b=this.getArgNumber("max");return this.compatRandomIntegerCalculation(a,b)}}]),b}(m),p=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"simpleExecute",value:function(){var a=this.getArgNumber("p");if(0>a||a>1)throw"Invalid probability";return this.getUniform(0,1)<=a?1:0}}]),b}(m),q=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"simpleExecute",value:function(){var a=this.getArgNumber("p"),b=this.getArgList("choices");if(0>a||a>1)throw"Invalid probability";if(0==b.length)return[];for(var c=[],d=0;d<b.length;d++){var e=b[d];this.getUniform(0,1,e)<=a&&c.push(e)}return c}}]),b}(m),r=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"compatRandomIndexCalculation",value:function(a){return this.getHash()%a.length}},{key:"simpleExecute",value:function(){var a=this.getArgList("choices");if(0===a.length)return[];var b=this.compatRandomIndexCalculation(a);return a[b]}}]),b}(m),s=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"simpleExecute",value:function(){var a=this.getArgList("choices"),b=this.getArgList("weights");if(0===a.length)return[];var c=0,d=b.map(function(a){return c+=a}),e=this.getUniform(0,c);return(0,l.reduce)(d,function(b,c,d){return b?b:c>=e?a[d]:b},null)}}]),b}(m),t=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"compatSampleIndexCalculation",value:function(a){return this.getHash(a)%(a+1)}},{key:"compatAllowSampleStoppingPoint",value:function(){return!0}},{key:"sample",value:function(a,b){for(var c=a.length,d=c-b,e=this.compatAllowSampleStoppingPoint(),f=c-1;f>0;f--){var g=this.compatSampleIndexCalculation(f),h=a[f];if(a[f]=a[g],a[g]=h,e&&d===f)return a.slice(f,c)}return a.slice(0,b)}},{key:"simpleExecute",value:function(){var a=(0,l.shallowCopy)(this.getArgList("choices")),b=0;return b=void 0!==this.args.draws?this.getArgNumber("draws"):a.length,this.sample(a,b)}}]),b}(m);b["default"]={PlanOutOpRandom:m,Sample:t,WeightedChoice:s,UniformChoice:r,BernoulliFilter:q,BernoulliTrial:p,RandomInteger:o,RandomFloat:n},a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},h=c(10),i=c(9),j=c(8),k=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){return this.getArgMixed("value")}}]),b}(h.PlanOutOp),l=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){return a.get(this.getArgString("var"))}}]),b}(h.PlanOutOp),m=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){(0,j.forEach)(this.getArgList("seq"),function(b){a.evaluate(b)})}}]),b}(h.PlanOutOp),n=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){var b=a.evaluate(this.getArgMixed("value")),c=!1;throw b&&(c=!0),new i.StopPlanOutException(c)}}]),b}(h.PlanOutOp),o=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){var b=this.getArgString("var"),c=this.getArgMixed("value");a.hasOverride(b)||((0,i.isOperator)(c)&&!c.salt&&(c.salt=b),"experimentSalt"==b&&(a.experimentSalt=c),a.set(b,a.evaluate(c)))}}]),b}(h.PlanOutOp),p=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){return(0,j.map)(this.getArgList("values"),function(b){return a.evaluate(b)})}}]),b}(h.PlanOutOp),q=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){for(var b=this.getArgList("values"),c=0;c<b.length;c++){var d=b[c],e=a.evaluate(d);if(null!==e&&void 0!==e)return e}return null}}]),b}(h.PlanOutOp),r=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"simpleExecute",value:function(){var a=this.getArgIndexish("base"),b=this.getArgMixed("index");return"number"==typeof b?b>=0&&b<a.length?a[b]:void 0:a[b]}}]),b}(h.PlanOutOpSimple),s=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){var b=this.getArgList("cond");for(var c in b){var d=b[c]["if"],e=b[c].then;if(a.evaluate(d))return a.evaluate(e)}return null}}]),b}(h.PlanOutOp),t=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){return(0,j.reduce)(this.getArgList("values"),function(b,c){return b?Boolean(a.evaluate(c)):b},!0)}}]),b}(h.PlanOutOp),u=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"execute",value:function(a){return(0,j.reduce)(this.getArgList("values"),function(b,c){return b?b:Boolean(a.evaluate(c))},!1)}}]),b}(h.PlanOutOp),v=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"commutativeExecute",value:function(a){return(0,j.reduce)(a,function(a,b){return a*b},1)}}]),b}(h.PlanOutOpCommutative),w=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"commutativeExecute",value:function(a){return(0,j.reduce)(a,function(a,b){return a+b},0)}}]),b}(h.PlanOutOpCommutative),x=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"getInfixString",value:function(){return"=="}},{key:"binaryExecute",value:function(a,b){return a===b}}]),b}(h.PlanOutOpBinary),y=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"binaryExecute",value:function(a,b){return a>b}}]),b}(h.PlanOutOpBinary),z=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"binaryExecute",value:function(a,b){return b>a}}]),b}(h.PlanOutOpBinary),A=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"binaryExecute",value:function(a,b){return b>=a}}]),b}(h.PlanOutOpBinary),B=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"binaryExecute",value:function(a,b){return a>=b}}]),b}(h.PlanOutOpBinary),C=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"binaryExecute",value:function(a,b){return a%b}}]),b}(h.PlanOutOpBinary),D=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"binaryExecute",value:function(a,b){return parseFloat(a)/parseFloat(b)}}]),b}(h.PlanOutOpBinary),E=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"unaryExecute",value:function(a){return Math.round(a)}}]),b}(h.PlanOutOpBinary),F=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"getUnaryString",value:function(){return"!"}},{key:"unaryExecute",value:function(a){return!a}}]),b}(h.PlanOutOpUnary),G=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"getUnaryString",value:function(){return"-"}},{key:"unaryExecute",value:function(a){return 0-a}}]),b}(h.PlanOutOpUnary),H=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"commutativeExecute",value:function(a){return Math.min.apply(null,a)}}]),b}(h.PlanOutOpCommutative),I=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"commutativeExecute",value:function(a){return Math.max.apply(null,a)}}]),b}(h.PlanOutOpCommutative),J=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"unaryExecute",value:function(a){return a.length}}]),b}(h.PlanOutOpUnary),K=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"simpleExecute",value:function(){var a=(0,j.deepCopy)(this.args);return delete a.op,delete a.salt,a}}]),b}(h.PlanOutOpSimple);b.Literal=k,b.Get=l,b.Seq=m,b.Set=o,b.Arr=p,b.Map=K,b.Coalesce=q,b.Index=r,b.Cond=s,b.And=t,b.Or=u,b.Product=v,b.Sum=w,b.Equals=x,b.GreaterThan=y,b.LessThan=z,b.LessThanOrEqualTo=A,b.GreaterThanOrEqualTo=B,b.Mod=C,b.Divide=D,b.Round=E,b.Not=F,b.Negative=G,b.Min=H,b.Max=I,b.Length=J,b.Return=n},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},i=c(1),j=d(i),k=c(6),l=d(k),m=c(3),n=c(8),o=c(7),p=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),g(b,[{key:"configureLogger",value:function(){}},{key:"setup",value:function(){this.name="test_name"}},{key:"log",value:function(a){}},{key:"getParamNames",value:function(){return this.getDefaultParamNames()}},{key:"previouslyLogged",value:function(){return!0}},{key:"assign",value:function(a,b){}}]),b}(j["default"]),q=function(){function a(){e(this,a)}return g(a,[{key:"addExperiment",value:function(a,b,c){throw"IMPLEMENT addExperiment"}},{key:"removeExperiment",value:function(a){throw"IMPLEMENT removeExperiment"}},{key:"setAutoExposureLogging",value:function(a){throw"IMPLEMENT setAutoExposureLogging"}},{key:"inExperiment",value:function(){throw"IMPLEMENT inExperiment"}},{key:"get",value:function(a,b){throw"IMPLEMENT get"}},{key:"logExposure",value:function(a){throw"IMPLEMENT logExposure"}},{key:"logEvent",value:function(a,b){throw"IMPLEMENT logEvent"}},{key:"requireExperiment",value:function(){this._experiment||this._assignExperiment()}},{key:"requireDefaultExperiment",value:function(){this._defaultExperiment||this._assignDefaultExperiment()}}]),a}(),r=function(a){function b(a){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a),this.name=this.getDefaultNamespaceName(),this.inputs=a||{},this.numSegments=1,this.segmentAllocations={},this.currentExperiments={},this._experiment=null,this._defaultExperiment=null,this.defaultExperimentClass=p,this._inExperiment=!1,this.setupDefaults(),this.setup(),this.availableSegments=(0,n.range)(this.numSegments),this.setupExperiments()}return f(b,a),g(b,[{key:"setupDefaults",value:function(){}},{key:"setup",value:function(){throw"IMPLEMENT setup"}},{key:"setupExperiments",value:function(){throw"IMPLEMENT setupExperiments"}},{key:"getPrimaryUnit",value:function(){return this._primaryUnit}},{key:"allowedOverride",value:function(){return!1}},{key:"getOverrides",value:function(){return{}}},{key:"setPrimaryUnit",value:function(a){this._primaryUnit=a}},{key:"addExperiment",value:function(a,b,c){var d=this.availableSegments.length;if(c>d)return!1;if(void 0!==this.currentExperiments[a])return!1;var e=new l["default"](this.name);e.set("sampled_segments",new m.Sample({choices:this.availableSegments,draws:c,unit:a}));for(var f=e.get("sampled_segments"),g=0;g<f.length;g++){this.segmentAllocations[f[g]]=a;var h=this.availableSegments.indexOf(f[g]);this.availableSegments[h]=this.availableSegments[d-1],this.availableSegments.splice(d-1,1),d-=1}this.currentExperiments[a]=b}},{key:"removeExperiment",value:function(a){var b=this;return void 0===this.currentExperiments[a]?!1:((0,n.forEach)(Object.keys(this.segmentAllocations),function(c){b.segmentAllocations[c]===a&&(delete b.segmentAllocations[c],b.availableSegments.push(c))}),delete this.currentExperiments[a],!0)}},{key:"getSegment",value:function(){var a=new l["default"](this.name),b=new m.RandomInteger({min:0,max:this.numSegments-1,unit:this.inputs[this.getPrimaryUnit()]});return a.set("segment",b),a.get("segment")}},{key:"_assignExperiment",value:function(){this.inputs=(0,n.extend)(this.inputs,(0,o.getExperimentInputs)(this.getName()));var a=this.getSegment();if(void 0!==this.segmentAllocations[a]){var b=this.segmentAllocations[a];this._assignExperimentObject(b)}}},{key:"_assignExperimentObject",value:function(a){var b=new this.currentExperiments[a](this.inputs);b.setName(this.getName()+"-"+a),b.setSalt(this.getName()+"-"+a),this._experiment=b,this._inExperiment=b.inExperiment(),this._inExperiment||this._assignDefaultExperiment()}},{key:"_assignDefaultExperiment",value:function(){this._defaultExperiment=new this.defaultExperimentClass(this.inputs)}},{key:"defaultGet",value:function(a,c){return h(Object.getPrototypeOf(b.prototype),"requireDefaultExperiment",this).call(this),this._defaultExperiment.get(a,c)}},{key:"getName",value:function(){return this.name}},{key:"setName",value:function(a){this.name=a}},{key:"previouslyLogged",value:function(){return this._experiment?this._experiment.previouslyLogged():null}},{key:"inExperiment",value:function(){return h(Object.getPrototypeOf(b.prototype),"requireExperiment",this).call(this),this._inExperiment}},{key:"setAutoExposureLogging",value:function(a){this._autoExposureLoggingSet=a,this._defaultExperiment&&this._defaultExperiment.setAutoExposureLogging(a),this._experiment&&this._experiment.setAutoExposureLogging(a)}},{key:"setGlobalOverride",value:function(a){var b=this.getOverrides();if(b&&(0,n.hasKey)(b,a)){var c=b[a];c&&(0,n.hasKey)(this.currentExperiments,c.experimentName)&&(this._assignExperimentObject(c.experimentName),this._experiment.addOverride(a,c.value))}}},{key:"setLocalOverride",value:function(a){var b=(0,n.getParameterByName)("experimentOverride");b&&(0,n.hasKey)(this.currentExperiments,b)&&(this._assignExperimentObject(b),(0,n.getParameterByName)(a)&&this._experiment.addOverride(a,(0,n.getParameterByName)(a)))}},{key:"getParams",value:function(a){return h(Object.getPrototypeOf(b.prototype),"requireExperiment",this).call(this),this._experiment&&this.getOriginalExperimentName()===a?this._experiment.getParams():null}},{key:"getOriginalExperimentName",value:function(){return this._experiment?this._experiment.getName().split("-")[1]:null}},{key:"get",value:function(a,c){return h(Object.getPrototypeOf(b.prototype),"requireExperiment",this).call(this),this.allowedOverride()&&this.setGlobalOverride(a),this.setLocalOverride(a),this._experiment?(void 0!==this._autoExposureLoggingSet&&this._experiment.setAutoExposureLogging(this._autoExposureLoggingSet),this._experiment.get(a,this.defaultGet(a,c))):this.defaultGet(a,c)}},{key:"logExposure",value:function(a){h(Object.getPrototypeOf(b.prototype),"requireExperiment",this).call(this),this._experiment&&this._experiment.logExposure(a)}},{key:"logEvent",value:function(a,c){h(Object.getPrototypeOf(b.prototype),"requireExperiment",this).call(this),this._experiment&&this._experiment.logEvent(a,c)}},{key:"getDefaultNamespaceName",value:function(){if((0,n.isObject)(this)&&this.constructor&&this!==this.window){var a=this.constructor.toString().match(/function\s*(\w+)/);if(a&&2===a.length)return a[1]}return"GenericNamespace"}}]),b}(q);b.Namespace=q,b.SimpleNamespace=r},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(3),g=c(8),h=function(){function a(b,c){d(this,a),c||(c={}),this.experimentSalt=b,this._overrides=(0,g.shallowCopy)(c),this._data=(0,g.shallowCopy)(c)}return e(a,[{key:"evaluate",value:function(a){return a}},{key:"getOverrides",value:function(){return this._overrides}},{key:"addOverride",value:function(a,b){this._overrides[a]=b,this._data[a]=b}},{key:"setOverrides",value:function(a){this._overrides=(0,g.shallowCopy)(a);var b=this;(0,g.forEach)(Object.keys(this._overrides),function(a){b._data[a]=b._overrides[a]})}},{key:"set",value:function(a,b){return"_data"===a?void(this._data=b):"_overrides"===a?void(this._overrides=b):"experimentSalt"===a?void(this.experimentSalt=b):void((0,g.hasKey)(this._overrides,a)||(b instanceof f.PlanOutOpRandom?(b.args.salt||(b.args.salt=a),this._data[a]=b.execute(this)):this._data[a]=b))}},{key:"get",value:function(a){return"_data"===a?this._data:"_overrides"===a?this._overrides:"experimentSalt"===a?this.experimentSalt:this._data[a]}},{key:"getParams",value:function(){return this._data}},{key:"del",value:function(a){delete this._data[a]}},{key:"toString",value:function(){return String(this._data)}},{key:"length",value:function(){return Object.keys(this._data).length}}]),a}();b["default"]=h,a.exports=b["default"]},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(8),e={},f={},g=function(a){return a?h((0,d.shallowCopy)(a)):{}},h=function(a){return(0,d.forEach)(Object.keys(a),function(b){(0,d.isFunction)(a[b])&&(a[b]=a[b]())}),a},i=function(a,b,c){c?(f[c]||(f[c]={}),f[c][a]=b):e[a]=b},j=function(a){var b=g(e);return a&&f[a]?(0,d.extend)(b,g(f[a])):b};b["default"]={registerExperimentInput:i,getExperimentInputs:j},a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b){var c=E.length,d=a.constructor,e=j(d)&&d.prototype||Object.Prototype,f="constructor";for(C(a,f)&&!F(b,f)&&b.push(f);c--;)f=E[c],f in a&&a[f]!==e[f]&&!F(b,f)&&b.push(f)}Object.defineProperty(b,"__esModule",{value:!0});var e=function(a){return a.replace(/^\s+|\s+$/g,"")},f=function(a){var b,c="undefined"!=typeof location,d="undefined"!=typeof window;if(c){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+a+"=([^&#]*)"),f=e.exec(location.search);b=null===f?"":decodeURIComponent(f[1].replace(/\+/g," "))}else b="";return null!==b&&void 0!==b&&0!==b.length||!d||void 0===window.localStorage||null===window.localStorage?b:window.localStorage.getItem(a)},g=function I(a){var b=a;if(a&&"object"==typeof a){b="[object Array]"===Object.prototype.toString.call(a)?[]:{};for(var c in a)b[c]=I(a[c])}return b},h=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},i=function(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(planout_code)},j=function(a){return"function"==typeof a||!1},k=function J(a){if(!h(a))return[];if(Object.keys)return Object.keys(a);var J=[];for(var b in a)C(a,b)&&J.push(b);return D&&d(a,J),J},l=function(a){if(!h(a))return[];var b=[];for(var c in a)b.push(c);return D&&d(a,b),b},m=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},n=m(l),o=m(k),p=function(a){return a},q=function(a,b){var c=c(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0},r=function(a){return a=o({},a),function(b){return q(b,a)}},s=function(a,b,c){return null==a?p:j(a)?t(a,b,c):h(a)?r(a):y(a)},t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){b=t(b,c);var d,e;if(B(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=f(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a);
}return a},v=function(a,b,c){b=s(b,c);for(var d=!B(a)&&d(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},w=function(a,b,c,d){b=t(b,d,4);var e=!B(a)&&e(a),f=(e||a).length,g=0;for(arguments.length<3&&(c=a[e?e[g]:g],g+=1);g>=0&&f>g;g++){var h=e?e[g]:g;c=b(c,a[h],h,a)}return c},x=function(a){return h(a)?i(a)?a.slice():n({},a):a},y=function(a){return function(b){return null==b?void 0:b[a]}},z=Math.pow(2,53)-1,A=y("length"),B=function(a){var b=A(a);return"number"==typeof b&&b>=0&&z>=b},C=function(a,b){return null!=a&&Object.prototype.hasOwnProperty.call(a,b)},D=!{toString:null}.propertyIsEnumerable("toString"),E=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],F=function(a,b,c,d){return B(a)||(a=values(a)),("number"!=typeof c||d)&&(c=0),a.indexOf(b)>=0},G=function(a){for(var b=[],c=0;a>c;c++)b.push(c);return b},H=function(a,b){return"undefined"!=typeof a[b]};b["default"]={deepCopy:g,map:v,reduce:w,getParameterByName:f,forEach:u,isFunction:j,trimTrailingWhitespace:e,hasKey:H,shallowCopy:x,extend:n,isObject:h,isArray:i,range:G},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=c(4),g=d(f),h=c(3),i=d(h),j=c(8),k=function(){return{literal:g.Literal,get:g.Get,set:g.Set,seq:g.Seq,"return":g.Return,index:g.Index,array:g.Arr,equals:g.Equals,and:g.And,or:g.Or,">":g.GreaterThan,"<":g.LessThan,">=":g.GreaterThanOrEqualTo,"<=":g.LessThanOrEqualTo,"%":g.Mod,"/":g.Divide,not:g.Not,round:g.Round,negative:g.Negative,min:g.Min,max:g.Max,length:g.Length,coalesce:g.Coalesce,map:g.Map,cond:g.Cond,product:g.Product,sum:g.Sum,randomFloat:i.RandomFloat,randomInteger:i.RandomInteger,bernoulliTrial:i.BernoulliTrial,bernoulliFilter:i.BernoulliFilter,uniformChoice:i.UniformChoice,weightedChoice:i.WeightedChoice,sample:i.Sample}},l=k(),m=function(a){return(0,j.isObject)(a)&&a.op},n=function(a){var b=a.op;if(!l[b])throw"Unknown Operator {op}";return new l[b](a)},o=function p(a){e(this,p),this.inExperiment=a};b.initFactory=k,b.isOperator=m,b.operatorInstance=n,b.StopPlanOutException=o},function(a,b,c){"use strict";function d(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(8),i=function(){function a(b){e(this,a),this.args=b}return g(a,[{key:"execute",value:function(a){throw"Implement this function"}},{key:"dumpArgs",value:function(){console.log(this.args)}},{key:"getArgMixed",value:function(a){if(void 0===this.args[a])throw"Missing argument "+a;return this.args[a]}},{key:"getArgNumber",value:function(a){var b=this.getArgMixed(a);if("number"!=typeof b)throw a+" is not a number.";return b}},{key:"getArgString",value:function(a){var b=this.getArgMixed(a);if("string"!=typeof b)throw a+" is not a string.";return b}},{key:"getArgList",value:function(a){var b=this.getArgMixed(a);if("[object Array]"!==Object.prototype.toString.call(b))throw a+" is not a list";return b}},{key:"getArgObject",value:function(a){var b=this.getArgMixed(a);if("[object Object]"!==Object.prototype.toString.call(b))throw a+" is not an object.";return b}},{key:"getArgIndexish",value:function(a){var b=this.getArgMixed(a),c=Object.prototype.toString.call(b);if("[object Object]"!==c&&"[object Array]"!==c)throw a+" is not an list or object.";return b}}]),a}(),j=function(a){function b(){e(this,b),f(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return d(b,a),g(b,[{key:"execute",value:function(a){this.mapper=a;var b=this;return(0,h.forEach)(Object.keys(this.args),function(c){b.args[c]=a.evaluate(b.args[c])}),this.simpleExecute()}}]),b}(i),k=function(a){function b(){e(this,b),f(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return d(b,a),g(b,[{key:"simpleExecute",value:function(){return this.unaryExecute(this.getArgMixed("value"))}},{key:"getUnaryString",value:function(){return this.args.op}},{key:"unaryExecute",value:function(a){throw"implement this"}}]),b}(j),l=function(a){function b(){e(this,b),f(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return d(b,a),g(b,[{key:"simpleExecute",value:function(){this.getArgMixed("left");return this.binaryExecute(this.getArgMixed("left"),this.getArgMixed("right"))}},{key:"getInfixString",value:function(){return this.args.op}},{key:"binaryExecute",value:function(a,b){throw"implement this"}}]),b}(j),m=function(a){function b(){e(this,b),f(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return d(b,a),g(b,[{key:"simpleExecute",value:function(){return this.commutativeExecute(this.getArgList("values"))}},{key:"getCommutativeString",value:function(){return this.args.op}},{key:"commutativeExecute",value:function(a){throw"implement this"}}]),b}(j);b.PlanOutOp=i,b.PlanOutOpSimple=j,b.PlanOutOpCommutative=m,b.PlanOutOpBinary=l,b.PlanOutOpUnary=k},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={};d.hash=function(a){a=unescape(encodeURIComponent(a));var b=[1518500249,1859775393,2400959708,3395469782];a+=String.fromCharCode(128);for(var c=a.length/4+2,e=Math.ceil(c/16),f=new Array(e),g=0;e>g;g++){f[g]=new Array(16);for(var h=0;16>h;h++)f[g][h]=a.charCodeAt(64*g+4*h)<<24|a.charCodeAt(64*g+4*h+1)<<16|a.charCodeAt(64*g+4*h+2)<<8|a.charCodeAt(64*g+4*h+3)}f[e-1][14]=8*(a.length-1)/Math.pow(2,32),f[e-1][14]=Math.floor(f[e-1][14]),f[e-1][15]=8*(a.length-1)&4294967295;for(var i,j,k,l,m,n=1732584193,o=4023233417,p=2562383102,q=271733878,r=3285377520,s=new Array(80),g=0;e>g;g++){for(var t=0;16>t;t++)s[t]=f[g][t];for(var t=16;80>t;t++)s[t]=d.ROTL(s[t-3]^s[t-8]^s[t-14]^s[t-16],1);i=n,j=o,k=p,l=q,m=r;for(var t=0;80>t;t++){var u=Math.floor(t/20),v=d.ROTL(i,5)+d.f(u,j,k,l)+m+b[u]+s[t]&4294967295;m=l,l=k,k=d.ROTL(j,30),j=i,i=v}n=n+i&4294967295,o=o+j&4294967295,p=p+k&4294967295,q=q+l&4294967295,r=r+m&4294967295}return d.toHexStr(n)+d.toHexStr(o)+d.toHexStr(p)+d.toHexStr(q)+d.toHexStr(r)},d.f=function(a,b,c,d){switch(a){case 0:return b&c^~b&d;case 1:return b^c^d;case 2:return b&c^b&d^c&d;case 3:return b^c^d}},d.ROTL=function(a,b){return a<<b|a>>>32-b},d.toHexStr=function(a){for(var b,c="",d=7;d>=0;d--)b=a>>>4*d&15,c+=b.toString(16);return c},b["default"]=d,a.exports=b["default"]}])});
//# sourceMappingURL=planout.map.js